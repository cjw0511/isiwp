/**
* jQuery EasyUI 1.3.3
* Copyright (c) 2009-2013 www.jeasyui.com. All rights reserved.
*
* Licensed under the GPL or commercial licenses
* To use it on other terms please contact us: info@jeasyui.com
* http://www.gnu.org/licenses/gpl.txt
* http://www.jeasyui.com/license_commercial.php
*
* jQuery EasyUI datagrid Extensions 1.2.2 release
* jQuery EasyUI datagrid 组件扩展
* jeasyui.extensions.datagrid.js
* 二次开发 陈建伟
* 最近更新：2013-07-24
*
* 依赖项：
*   1、jquery.jdirk.js v1.0 beta late
*   2、jeasyui.extensions.js v1.0 beta late
*   3、jeasyui.extensions.menu.js v1.0 beta late
*   4、jeasyui.extensions.panel.js v1.0 beta late 和 jeasyui.extensions.window.js v1.0 beta late(可选)
*
* Copyright (c) 2013 ChenJianwei personal All rights reserved.
* http://www.chenjianwei.org
*/
!function(a,b){function mb(b,c,d){var e,f,g,h,i,j,k,n;d=d||(c._extensionsDatagrid?c._extensionsDatagrid:c._extensionsDatagrid={}),kb(b,d),e=b.datagrid("getData"),f=d.oldData,e!=f&&(d.filterData=[]),nb(b,c),c.columnFilter&&(d.oldData=e,g=b.datagrid("getPanel").find("div.datagrid-view div.datagrid-header"),h=g.find("table.datagrid-htable tr.datagrid-header-row"),i=h.find("td[field]").filter(function(){var b=a(this),c=b.attr("colspan");return c&&"1"!=c||b.find("div.datagrid-header-check,div.datagrid-header-rownumber").length?!1:!0}),j=c.columnFilter=a.extend({panelHeight:100,position:"top"},c.columnFilter),k=a.array.contains(["top","bottom"],j.position)?j.position:"top",j.panelHeight=a.isNumeric(j.panelHeight)&&j.panelHeight>=80?j.panelHeight:80,g.height(),n=b.datagrid("getRows"),i.each(function(){var e=a(this).addClass("datagrid-header-filter").removeClass("datagrid-header-filter-top datagrid-header-filter-bottom"),g=(e.find("div.datagrid-cell").addClass("datagrid-header-filter-cell"),e.attr("field")),h=b.datagrid("getColumnOption",g),l=h.width,o=(a("<hr />").addClass("datagrid-header-filter-line")["top"==k?"prependTo":"appendTo"](this),a("<div></div>").attr("field",g).addClass("datagrid-header-filter-container").css({height:j.panelHeight,width:l})["top"==k?"prependTo":"appendTo"](this));e.addClass("top"==k?"datagrid-header-filter-bottom":"datagrid-header-filter-top"),g&&ob(b,c,d,o,h,n,i)}),d.filterData&&d.filterData.length?b.datagrid("hideRows",d.filterData):tb(b,c,d,n,i))}function nb(b,c){var d,e;c.columnFilter&&(d=b.datagrid("getPanel").find("div.datagrid-view div.datagrid-header table.datagrid-htable tr.datagrid-header-row td[field]").filter(function(){var b=a(this),c=b.attr("colspan");return c&&"1"!=c||b.find("div.datagrid-header-check,div.datagrid-header-rownumber").length?!1:!0}),d.find("hr.datagrid-header-filter-line,div.datagrid-header-filter-container").remove(),e=b.datagrid("getColumnFields","all"),b.datagrid("fixColumnSize",e[e.length-1]))}function ob(b,c,d,e,f,g,h){if(f.filterable){var i=f.field,j=b.datagrid("getDistinctColumnData",i),k=a.array.contains(["checkbox","livebox","caps","lower","none"],f.filter)?f.filter:"checkbox",l=f.precision,m=f.step;switch(k){case"checkbox":pb(b,d,e,i,g,j);break;case"livebox":qb(b,e,i,g);break;case"caps":rb(b,e,i,m,l,g,j,"<=",c.columnFilter.panelHeight,h);break;case"lower":rb(b,e,i,m,l,g,j,">=",c.columnFilter.panelHeight,h);break;case"none":}}}function pb(b,c,d,e,f,g){a.each(g,function(g,h){var i=a("<div></div>").addClass("datagrid-header-filter-item").attr("text",h).appendTo(d),l=(a("<div></div>").addClass("datagrid-header-filter-item-text").text(h).appendTo(i),a("<div></div>").addClass("datagrid-header-filter-item-icon").appendTo(i),function(){var d=a.array.filter(f,function(a){return a[e]==h}),g=a.array.filter(c.filterData,function(a){return a[e]==h});b.datagrid(g.length?"showRows":"hideRows",d)});i.click(l)})}function qb(b,c,d,e){var f,g;a("<div></div>").addClass("datagrid-header-filter-livebox-text").text("模糊过滤：").appendTo(c),f=a("<input />").addClass("datagrid-header-filter-livebox").appendTo(c),g=a("<a />").linkbutton({plain:!0,iconCls:"icon-search"}).appendTo(c).click(function(){var c,g;return b.datagrid("showRows",!0),c=f.val(),a.string.isNullOrEmpty(c)?(f.focus(),void 0):(g=a.array.filter(e,function(a){return-1==String(a[d]).indexOf(c)}),b.datagrid("hideRows",g),f.focus(),void 0)}),a("<a />").linkbutton({plain:!0,iconCls:"icon-undo"}).appendTo(c).click(function(){var a=f.val();a?(f.val("").focus(),g.click()):f.focus()}),f.keypress(function(a){13==a.which&&g.click()})}function rb(b,c,d,e,f,g,h,i,j,k){var l=a.array.map(h,function(b){return b=parseFloat(b),a.isNumeric(b)?b:0}),m=l.length?a.array.min(l):0,n=l.length?a.array.max(l):0,o=l.length?a.array.max(l,function(b,c){return a.util.compare(a.number.precision(b),a.number.precision(c))}):0,p=l.length?a.number.precision(o):0,q=j-45,r=a("<div></div>").addClass("datagrid-header-filter-itemwrap").text(i).appendTo(c),s=a("<div></div>").addClass("datagrid-header-filter-sliderwrap").css({height:q+10})["<="==i?"appendTo":"prependTo"](c),t=a("<input />").addClass("datagrid-header-filter-numeric").appendTo(r),u=a("<input />").addClass("datagrid-header-filter-slider").appendTo(s),v=function(a){sb(b,d,g,a,i,t,u,k)};t.numberbox({value:"<="==i?n:m,min:m,max:n,precision:f,onChange:v}),t.keypress(function(b){if(13==b.which){var c=t.val();t.numberbox("setValue",a.isNumeric(c)?c:0)}}),u.slider({height:q,mode:"v",showTip:!0,value:"<="==i?n:m,min:m,max:n,rule:[m,"|",n],step:e,onSlideEnd:v,tipFormatter:function(b){return a.number.round(b||0,p)}})}function sb(b,c,d,e,f,g,h,i){var l,j=i||b.datagrid("getPanel").find("div.datagrid-view div.datagrid-header table.datagrid-htable tr.datagrid-header-row td[field]").filter(function(){var b=a(this),c=b.attr("colspan");return c&&"1"!=c||b.find("div.datagrid-header-check,div.datagrid-header-rownumber").length?!1:!0}),k=j.filter(function(){return a(this).attr("field")==c});g=g?g:k.find(".datagrid-header-filter-numeric"),h=h?h:k.find(".datagrid-header-filter-slider"),l=a.array.filter(d,function(b){return b=parseFloat(b[c]),b=a.isNumeric(b)?b:0,">="==f?e>b:b>e}),b.datagrid("showRows",!0).datagrid("hideRows",l),g.numberbox("setValue",e),h.slider("setValue",e)}function tb(b,c,d,e,f){c.columnFilter&&(f=f||b.datagrid("getPanel").find("div.datagrid-view div.datagrid-header table.datagrid-htable tr.datagrid-header-row td[field]").filter(function(){var b=a(this),c=b.attr("colspan");return c&&"1"!=c||b.find("div.datagrid-header-check,div.datagrid-header-rownumber").length?!1:!0}),f.each(function(){var c=a(this),f=c.attr("field");ub(b,d,e,c,f)}))}function ub(b,c,d,e,f){var g=g=b.datagrid("getColumnOption",f),i=(g.precision,a.array.contains(["checkbox","livebox","caps","lower","none"],g.filter)?g.filter:"checkbox");switch(i){case"checkbox":vb(b,c,d,e,f);break;case"livebox":xb(b,c,d,e,f);break;case"caps":yb(b,c,d,e,f);break;case"lower":zb(b,c,d,e,f);break;case"none":}}function vb(b,c,d,e,f){e.find("div.datagrid-header-filter-item").each(function(){var b=a(this),e=b.attr("text"),g=b.find("div.datagrid-header-filter-item-icon"),h=a.array.sum(d,function(a){return a[f]==e?1:0}),i=a.array.sum(c.filterData,function(a){return a[f]==e?1:0}),j=0==i?"tree-checkbox1":i>=h?"tree-checkbox0":"tree-checkbox2";a.easyui.tooltip.init(b,{content:(a.string.isNullOrEmpty(e)?"空白":e)+": 共"+h+"个元素"}),wb(g,j)})}function wb(a,b){a.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass(b)}function xb(){}function yb(){}function zb(){}function Ab(b,c,d){d.onHeaderContextMenuBak=c.onHeaderContextMenu,c.onHeaderContextMenu=function(e,f){if(e.preventDefault(),a.isFunction(d.onHeaderContextMenuBak)&&d.onHeaderContextMenuBak.apply(this,arguments),c.enableHeaderContextMenu){var g=a.fn.datagrid.extensions.parseContextMenuEventData(b,c,e),h=Fb(b,c,d,e,f,g);a.easyui.showMenu({items:h,left:e.pageX,top:e.pageY,hideDisabledMenu:c.hideDisabledMenu})}}}function Bb(b,c,d){d.onRowContextMenuBak=c.onRowContextMenu,c.onRowContextMenu=function(e,f,g){if(e.preventDefault(),a.isFunction(d.onRowContextMenuBak)&&d.onRowContextMenuBak.apply(this,arguments),c.selectOnRowContextMenu&&b.datagrid("selectRow",f),c.enableRowContextMenu){var h=a.fn.datagrid.extensions.parseContextMenuEventData(b,c,e),i=Gb(b,c,d,e,f,g,h);c.autoBindDblClickRow&&c.dblClickRowMenuIndex>=0&&i.length>c.dblClickRowMenuIndex&&(i[c.dblClickRowMenuIndex].bold=!0),a.easyui.showMenu({items:i,left:e.pageX,top:e.pageY,hideDisabledMenu:c.hideDisabledMenu})}}}function Cb(b,c,d){b.datagrid("getPanel").find(".datagrid-view .datagrid-header table.datagrid-htable tr.datagrid-header-row td[field]").filter(function(){var b=a(this),c=b.attr("colspan");return c&&"1"!=c||b.find("div.datagrid-header-check,div.datagrid-header-rownumber").length?!1:!0}).find("div.datagrid-cell").each(function(){Db(b,c,d,this)})}function Db(b,c,d,e){e=a.util.parseJquery(e),e.off(".hoverArrow");var f=a("<span></span>").addClass("s-btn-downarrow").addClass("datagrid-header-cell-arrow").click(function(e){var g=a(this),h=g.offset(),i=g.outerHeight(),j=g.parent().parent().attr("field"),k=a.fn.datagrid.extensions.parseContextMenuEventData(b,c,e),l=Fb(b,c,d,e,j,k),m=a.easyui.showMenu({items:l,left:h.left,top:h.top+i}),n=m.menu("options"),o=n.onHide;return f.hidable=!1,n.onHide=function(){f.hidable=!0,f.removeClass("datagrid-header-cell-arrow-show"),o.apply(this,arguments)},!1}).appendTo(e);e.on({"mouseenter.hoverArrow":function(){f.addClass("datagrid-header-cell-arrow-show")},"mouseleave.hoverArrow":function(){(!a.util.isBoolean(f.hidable)||f.hidable)&&f.removeClass("datagrid-header-cell-arrow-show")}})}function Eb(b,c,d){d.onDblClickRowBak=c.onDblClickRow,c.onDblClickRow=function(e,f){var g,h,i;a.isFunction(d.onDblClickRowBak)&&d.onDblClickRowBak.apply(this,arguments),b.datagrid("selectRow",e),g=a.fn.datagrid.extensions.parseContextMenuEventData(b,c,null),items=Gb(b,c,d,null,e,f,g),c.autoBindDblClickRow&&c.dblClickRowMenuIndex>=0&&items.length>c.dblClickRowMenuIndex&&(h=items[c.dblClickRowMenuIndex],i=h.handler||h.onclick,i(null,e,f,g,b,h,null)),c.autoEditing&&b.datagrid("beginEdit",e)}}function Fb(b,c,d,e,f,g){var j,h=[],i=a.util.likeArray(c.headerContextMenu)&&!a.util.isString(c.headerContextMenu)?c.headerContextMenu:[];return i.length&&a.array.merge(h,i),j=Hb(b,c,d,e,f,g),j.length&&a.array.merge(h,"-",j),h=a.fn.datagrid.extensions.parseHeaderContextMenuMap(e,f,g,h,b),"-"==h[0]&&a.array.removeAt(h,0),h}function Gb(b,c,d,e,f,g,h){var k,i=[],j=a.util.likeArray(c.rowContextMenu)&&!a.util.isString(c.rowContextMenu)?c.rowContextMenu:[];return j.length&&a.array.merge(i,j),k=Kb(b,c,d,e,f,g,h),k.length&&a.array.merge(i,"-",k),i=a.fn.datagrid.extensions.parseRowContextMenuMap(e,f,g,h,i,b),"-"==i[0]&&a.array.removeAt(i,0),i}function Hb(b,c,d,e,f,g){var l,m,n,o,p,q,r,h=[],i=c.exportMenu,j=b.datagrid("getColumnOption",f),k=b.datagrid("getColumnOption",f).sortable;return"object"==typeof i&&(i=a.extend({current:!1,all:!1,submenu:!0},i)),l={text:"升序",iconCls:"",disabled:1!=k,handler:function(){return b.datagrid("sort",{sortName:f,sortOrder:"asc"})}},m={text:"降序",iconCls:"",disabled:1!=k,handler:function(){return b.datagrid("sort",{sortName:f,sortOrder:"desc"})}},n={text:"显示/隐藏列",iconCls:"",disabled:!1,children:[{text:"显示全部列",iconCls:function(){var b=d.fields?d.fields.length:0,c=a.array.sum(d.fieldOptions,function(a){return a.hidden?0:1});return c>=b?"tree-checkbox1":0==c?"tree-checkbox0":"tree-checkbox2"},hideOnClick:!1,handler:function(b,c,e,f,g,h){a.each(d.fields,function(){f.datagrid("showColumn",this)}),a(this).parent().children("div.menu-item:not(:eq(1))").each(function(){h.menu("setIcon",{target:this,iconCls:"tree-checkbox1"}),h.menu("enableItem",this)})}},{text:"还原默认",iconCls:"",hideOnClick:!1,handler:function(b,c,e,f,g,h){a.each(d.fieldOptionsBackup,function(){f.datagrid(1==this.hidden?"hideColumn":"showColumn",this.field)});var i=a(this).parent();i.children("div.menu-item:gt(1)").each(function(){var b=a(this).text(),c=a.array.first(d.fieldOptions,function(a){return a.title==b});c&&h.menu("setIcon",{target:this,iconCls:c.hidden?"tree-checkbox0":"tree-checkbox1"}),h.menu("enableItem",this)}),i.children("div.menu-item:first").each(function(){var b=d.fields?d.fields.length:0,c=a.array.sum(d.fieldOptions,function(a){return a.hidden?0:1});h.menu("setIcon",{target:this,iconCls:c>=b?"tree-checkbox1":0==c?"tree-checkbox0":"tree-checkbox2"})})}},"-"]},o={text:"过滤/显示",iconCls:"",disabled:!j.filterable,children:[]},p={text:"导出当前页",iconCls:"",disabled:!(1==i||1==i.current),handler:function(){return b.datagrid("exportExcel",!1)}},q={text:"导出全部",iconCls:"",disabled:!(1==i||1==i.all),handler:function(){return b.datagrid("exportExcel",!0)}},a.util.merge(n.children,Ib(b,c,d,e,f,g)),j.filterable&&a.util.merge(o.children,Jb(b,c,d,e,f,g)),a.util.merge(h,[l,m,"-",n,o]),r=[p,q],i&&a.array.merge(h,"-","object"!=typeof i||i.submenu?{text:"导出数据",iconCls:"",children:r}:r),h}function Ib(b,c,d){return a.array.map(d.fieldOptions,function(b){var c=function(c,e,f,g,h,i){var l,m,j=a.util.parseJquery(this),k=j.parent().find(".menu-item:gt(1) .tree-checkbox1").length;(1!=k||b.hidden)&&(g.datagrid(b.hidden?"showColumn":"hideColumn",b.field),i.menu("setIcon",{target:this,iconCls:b.hidden?"tree-checkbox0":"tree-checkbox1"}),k=a.array.sum(d.fieldOptions,function(a){return a.hidden?0:1}),l=d.fields?d.fields.length:0,i.menu("setIcon",{target:j.parent().children("div.menu-item:first"),iconCls:k>=l?"tree-checkbox1":0==k?"tree-checkbox0":"tree-checkbox2"}),m=j.parent().find(".menu-item:gt(1)").filter(function(){return a(".tree-checkbox1",this).length?!0:!1}),m.each(function(){i.menu(m.length>1?"enableItem":"disableItem",this)}))};return{text:b.title||b.field,iconCls:b.hidden?"tree-checkbox0":"tree-checkbox1",hideOnClick:!1,disabled:b.hidable?!1:!0,handler:c}})}function Jb(b,c,d,e,f){var n,o,p,h=b.datagrid("getRows"),i=b.datagrid("getDistinctColumnData",f),j=[{text:"全部",hideOnClick:!1,iconCls:d.filterData&&d.filterData.length?d.filterData.length>=h.length?"tree-checkbox0":"tree-checkbox2":"tree-checkbox1",handler:function(b,c,e,f,g,h){d.filterData&&d.filterData.length?f.datagrid("showRows",!0):f.datagrid("hideRows",!0),a(this).parent().children("div.menu-item[hideOnClick=false]").each(function(){h.menu("setIcon",{target:this,iconCls:d.filterData&&d.filterData.length?"tree-checkbox0":"tree-checkbox1"})})}},"-"],k=i.length>=15,l=k?a.array.left(i,10):i,m=a.array.map(l,function(b){var c=a.array.filter(h,function(a){return a[f]==b}),e=c.length,g=a.array.sum(d.filterData,function(a){return a[f]==b?1:0}),i=g?g>=e?"tree-checkbox0":"tree-checkbox2":"tree-checkbox1",j=function(e,f,g,i,j,k){var l=a.array.sum(d.filterData,function(a){return a[f]==b?1:0});i.datagrid(l?"showRows":"hideRows",c),k.menu("setIcon",{target:this,iconCls:l?"tree-checkbox1":"tree-checkbox0"}),a(this).parent().children("div.menu-item:first").each(function(){k.menu("setIcon",{target:this,iconCls:d.filterData&&d.filterData.length?d.filterData.length>=h.length?"tree-checkbox0":"tree-checkbox2":"tree-checkbox1"})})};return{text:b,iconCls:i,hideOnClick:!1,handler:j}});return a.array.merge(j,m),k&&(n=b.datagrid("getColumnOption",f),o=n.title?n.title:n.field,p=function(){var c=a("<input />").attr({type:"button",value:"全部选择"}).click(function(){b.datagrid("showRows",!0),a(this).parent().find(":checkbox").each(function(){this.checked=!0})}),g=a("<input />").attr({type:"button",value:"全部不选"}).click(function(){b.datagrid("hideRows",!0),a(this).parent().find(":checkbox").each(function(){this.checked=!1})});a("<div></div>").append("<div>列："+o+"，共"+i.length+"项</div><hr />").css({padding:"10px"}).append(c).append(g).append("<hr />").each(function(){var c=a(this),e=a("<ul></ul>").css({"list-style-type":"decimal","padding-left":"20px","line-height":"18px"}).appendTo(c);a.each(i,function(c,g){var i="itemCheckbox_"+a.util.guid("N"),j=!a.array.some(d.filterData,function(a){return a[f]==g}),k=a("<li></li>").appendTo(e),l=a("<input />").attr({type:"checkbox",id:i,checked:j}).appendTo(k),n=(a("<label></label>").attr("for",i).text(g).appendTo(k),function(){var c=a.array.filter(h,function(a){return a[f]==g}),e=a.array.sum(d.filterData,function(a){return a[f]==g?1:0});b.datagrid(e?"showRows":"hideRows",c)});l.click(n)})}).dialog({title:"过滤/显示",iconCls:"",height:260,width:220,left:e.pageX,top:e.pageY,collapsible:!1,minimizable:!1,maximizable:!1,closable:!0,modal:!0,resizable:!0,onClose:function(){a.util.parseJquery(this).dialog("destroy")}}).dialog("open")},a.array.merge(j,["-",{text:"处理更多(共"+i.length+"项)...",iconCls:"",handler:p}])),j}function Kb(b,c,d,e,f,g,h){var m,n,o,p,q,r,s,t,u,v,w,x,y,z,i=[],j=c.pagingMenu,k=c.moveMenu,l=c.exportMenu;return"object"==typeof j&&(j=a.extend({disabled:!1,submenu:!0},j)),"object"==typeof k&&(k=a.extend({up:!1,down:!1,submenu:!0},k)),"object"==typeof l&&(l=a.extend({current:!1,all:!1,submenu:!0},l)),m={text:"刷新当前页",iconCls:"pagination-load",disabled:!1,handler:function(){b.datagrid("reload")}},n={text:"首页",iconCls:"pagination-first",disabled:function(){return!c.pagination||h.page<=1},handler:function(){h.page>1&&h.pager.pagination("select",1)}},o={text:"上一页",iconCls:"pagination-prev",disabled:function(){return!c.pagination||h.page<=1},handler:function(){h.page>1&&h.pager.pagination("select",h.page-1)}},p={text:"下一页",iconCls:"pagination-next",disabled:function(){return!c.pagination||h.page>=h.pageCount},handler:function(){h.page<h.pageCount&&h.pager.pagination("select",h.page+1)}},q={text:"末页",iconCls:"pagination-last",disabled:function(){return!c.pagination||h.page>=h.pageCount},handler:function(){h.page<h.pageCount&&h.pager.pagination("select",h.pageCount)}},r={text:"移至最上",iconCls:"",disabled:!(1==k||1==k.top),handler:function(){b.datagrid("moveRow",{source:f,target:0,point:"top"})}},s={text:"上移",iconCls:"",disabled:!(1==k||1==k.up),handler:function(){b.datagrid("shiftRow",{point:"up",index:f})}},t={text:"下移",iconCls:"",disabled:!(1==k||1==k.down),handler:function(){b.datagrid("shiftRow",{point:"down",index:f})}},u={text:"移至最下",iconCls:"",disabled:!(1==k||1==k.bottom),handler:function(){var a=b.datagrid("getRows");b.datagrid("moveRow",{source:f,target:a.length-1,point:"bottom"})}},v={text:"导出当前页",iconCls:"",disabled:!(1==l||1==l.current),handler:function(){return b.datagrid("exportExcel",!1)}},w={text:"导出全部",iconCls:"",disabled:!(1==l||1==l.all),handler:function(){return b.datagrid("exportExcel",!0)}},i.push(m),x=[n,o,p,q],y=[r,s,"-",t,u],z=[v,w],j&&a.array.merge(i,"-","object"!=typeof j||j.submenu?{text:"翻页",iconCls:"",disabled:!(1==j||!j.disabled),children:x}:x),k&&a.array.merge(i,"-","object"!=typeof k||k.submenu?{text:"上/下移动",iconCls:"",disabled:!k,children:y}:y),l&&a.array.merge(i,"-","object"!=typeof l||l.submenu?{text:"导出数据",iconCls:"",disabled:!l,children:z}:z),i}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc;a.fn.datagrid.extensions={},c=a.fn.datagrid.methods.updateRow,d=a.fn.datagrid.methods.appendRow,e=a.fn.datagrid.methods.insertRow,f=function(b,d){if(d&&d.row&&a.isNumeric(d.index)){var e=a.util.parseJquery(b),f=e.datagrid("options");a.isFunction(f.onBeforeUpdateRow)&&0==f.onBeforeUpdateRow.call(b,d.index,d.row)||(c.call(e,e,d),mb(e,f),lb(e,f),Mb(e,f,d.index,d.row),a.isFunction(f.onUpdateRow)&&f.onUpdateRow.call(b,d.index,d.row))}},g=function(b,c){var e,f,g,h;c&&(e=a.util.parseJquery(b),f=e.datagrid("options"),a.isFunction(f.onBeforeAppendRow)&&0==f.onBeforeAppendRow.call(b,c)||(d.call(e,e,c),g=e.datagrid("getRows"),h=g.length-1,mb(e,f),lb(e,f),Mb(e,f,h,c),a.isFunction(f.onAppendRow)&&f.onAppendRow.call(b,c)))},h=function(b,c){if(c&&c.row&&a.isNumeric(c.index)){var d=a.util.parseJquery(b),f=d.datagrid("options");a.isFunction(f.onBeforeInsertRow)&&0==f.onBeforeInsertRow.call(b,c.index,c.row)||(e.call(d,d,c),mb(d,f),lb(d,f),Mb(d,f,c.index,c.row),a.isFunction(f.onInsertRow)&&f.onInsertRow.call(b,c.index,c.row))}},i=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getChecked"),f=a.array.map(e,function(a){return d.datagrid("getRowIndex",a)});return a.array.contains(f,c)},j=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getSelections"),f=a.array.map(e,function(a){return d.datagrid("getRowIndex",a)});return a.array.contains(f,c)},k=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getColumnFields"),f=d.datagrid("getColumnFields",!0);f&&f.length&&a.array.contains(e,c)&&!a.array.contains(f,c)&&d.datagrid("moveColumn",{source:c,target:f[f.length-1],point:"after"})},l=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getColumnFields"),f=d.datagrid("getColumnFields",!0);e&&e.length&&!a.array.contains(e,c)&&a.array.contains(f,c)&&d.datagrid("moveColumn",{source:c,target:e[0],point:"before"})},m=function(b,c){var d,e,f,g,h,i,j;if(c&&a.isNumeric(c.source)&&a.isNumeric(c.target)&&c.source!=c.target&&c.point&&(a.array.contains(["top","bottom"],c.point)||(c.point="top"),d=a.util.parseJquery(b),e=d.datagrid("options"),f=d.datagrid("getRows"),g=f[c.source],h=f[c.target],g&&h&&(!a.isFunction(e.onBeforeDrop)||0!=e.onBeforeDrop.call(b,c.target,c.source,c.point)))){switch(i=d.datagrid("popRow",c.source),j=d.datagrid("getRowIndex",h),f=d.datagrid("getRows"),c.point){case"top":d.datagrid("insertRow",{index:j,row:i});break;case"bottom":j++>=f.length?d.datagrid("appendRow",i):d.datagrid("insertRow",{index:j,row:i})}i&&a.isFunction(e.onDrop)&&e.onDrop.call(b,c.target,c.source,c.point)}},n=function(b,c){if(c&&a.isNumeric(c.index)&&c.point&&a.array.contains(["up","down"],c.point)){var d=a.util.parseJquery(b),f=(d.datagrid("options"),"up"==c.point?c.index-1:c.index+1),g="up"==c.point?"top":"bottom";d.datagrid("moveRow",{source:c.index,target:f,point:g})}},o=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getRows"),f=c+1;return e[f]?e[f]:null},p=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getRows"),f=c-1;return e[f]?e[f]:null},q=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getRows"),f=e[c];return f?(d.datagrid("deleteRow",c),f):null},r=function(b){function e(a,b){var c=a.draggable("proxy").find("span.tree-dnd-icon");c.removeClass("tree-dnd-yes tree-dnd-no").addClass(b?"tree-dnd-yes":"tree-dnd-no")}var c=a.util.parseJquery(b),d=c.datagrid("options");c.datagrid("getPanel").find("div.datagrid-view div.datagrid-body table.datagrid-btable tr.datagrid-row").draggable({disabled:!1,revert:!0,cursor:"default",deltaX:10,deltaY:5,proxy:function(b){var h,d=a.util.parseJquery(b),e=parseInt(d.attr("datagrid-row-index")),f=c.datagrid("getRowDom",e).clone(),g=a("<tr></tr>").addClass("datagrid-row datagrid-row-selected");return a("<td><span class='tree-dnd-icon tree-dnd-no' ></span></td>").appendTo(g),h=f.find("td").each(function(a){6>a&&g.append(this)}),h.length>6&&a("<td>...</td>").css("width","40px").appendTo(g),a("<table></table>").addClass("tree-node-proxy").appendTo("body").append(g).hide()},onBeforeDrag:function(e){var f=a.util.parseJquery(this),g=parseInt(f.attr("datagrid-row-index")),h=c.datagrid("getRowData",g);return a.isFunction(d.onBeforeDrag)&&0==d.onBeforeDrag.call(b,g,h)?!1:1!=e.which?!1:"checkbox"==e.target.type?!1:void 0},onStartDrag:function(){var e=a.util.parseJquery(this),f=parseInt(e.attr("datagrid-row-index")),g=c.datagrid("getRowData",f);e.draggable("proxy").css({left:-1e4,top:-1e4}),a.isFunction(d.onBeforeDrag)&&d.onStartDrag.call(b,f,g)},onStopDrag:function(){var e=a.util.parseJquery(this),f=parseInt(e.attr("datagrid-row-index")),g=c.datagrid("getRowData",f);a.isFunction(d.onStopDrag)&&d.onStopDrag.call(b,f,g)},onDrag:function(b){var c=b.pageX,d=b.pageY,e=b.data.startX,f=b.data.startY,g=Math.sqrt((c-e)*(c-e)+(d-f)*(d-f));g>15&&a(this).draggable("proxy").show(),this.pageY=b.pageY}}).droppable({accept:"tr.datagrid-row",onDragEnter:function(f,g){var h=a.util.parseJquery(this),i=a.util.parseJquery(g),j=parseInt(h.attr("datagrid-row-index")),k=parseInt(i.attr("datagrid-row-index")),l=c.datagrid("getRowData",j),m=c.datagrid("getRowData",k),n=c.datagrid("getRowDom",j),o=n.find("td"),p=h.data("dnd"),q={droper:h,drager:i,droperIndex:j,dragerIndex:k,droperRow:l,dragerRow:m,droperRowDom:n,mark:o};p?a.extend(p,q):h.data("dnd",q),a.isFunction(d.onDragEnter)&&0==d.onDragEnter.call(b,l,m)&&(e(i,!1),o.removeClass("datagrid-header-cell-top datagrid-header-cell-bottom"),h.droppable("disable"))},onDragOver:function(c,f){var m,n,o,g=a.util.parseJquery(this),h=g.data("dnd"),i=h.drager,j=h.droperRow,k=h.dragerRow,l=h.mark;g.droppable("options").disabled||(m=f.pageY,n=g.offset().top,o=n+g.outerHeight(),e(i,!0),l.removeClass("datagrid-header-cell-top datagrid-header-cell-bottom"),m>n+(o-n)/2?l.addClass("datagrid-header-cell-bottom"):l.addClass("datagrid-header-cell-top"),0==d.onDragOver.call(b,j,k)&&(e(i,!1),l.removeClass("datagrid-header-cell-top datagrid-header-cell-bottom"),g.droppable("disable")))},onDragLeave:function(){var g=a.util.parseJquery(this),h=g.data("dnd"),i=h.drager,j=h.droperRow,k=h.dragerRow,l=h.mark;e(i,!1),l.removeClass("datagrid-header-cell-top datagrid-header-cell-bottom"),a.isFunction(d.onDragLeave)&&d.onDragLeave.call(b,j,k)},onDrop:function(){var e=a.util.parseJquery(this),f=e.data("dnd"),g=f.droperIndex,h=f.dragerIndex,i=f.mark,j=i.hasClass("datagrid-header-cell-top")?"top":"bottom";c.datagrid("moveRow",{target:g,source:h,point:j}),i.removeClass("datagrid-header-cell-top datagrid-header-cell-bottom")}}),d.dndRow=!0},s=function(b){var c=a.util.parseJquery(b),d=c.datagrid("options");c.datagrid("getPanel").find("div.datagrid-view div.datagrid-body table.datagrid-btable tr.datagrid-row").draggable("disable"),d.dndRow=!1},t=function(b,c){var d=a.util.parseJquery(b),e=a.array.merge([],d.datagrid("getColumnFields",!0),d.datagrid("getColumnFields",!1)),f=a.array.indexOf(e,c);return-1==f||f+1>=e.length?null:d.datagrid("getColumnOption",e[f+1])},u=function(b,c){var d=a.util.parseJquery(b),e=a.array.merge([],d.datagrid("getColumnFields",!0),d.datagrid("getColumnFields",!1)),f=a.array.indexOf(e,c);return 1>f?null:d.datagrid("getColumnOption",e[f-1])},v=function(c,d){var e,g,h,f,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;d&&d.source&&d.target&&d.source!=d.target&&d.point&&(a.array.contains(["before","after"],d.point)||(d.point="before"),e=a.util.parseJquery(c),e.datagrid("hasMuliRowHeader")||(f=e.datagrid("options"),i=e.datagrid("getColumnFields"),j=e.datagrid("getColumnFields",!0),a.array.contains(i,d.source)&&(g=!1),g==b&&a.array.contains(j,d.source)&&(g=!0),a.array.contains(i,d.target)&&(h=!1),h==b&&a.array.contains(j,d.target)&&(h=!0),g!=b&&h!=b&&(a.isFunction(f.onBeforeMoveColumn)&&0==f.onBeforeMoveColumn.call(c,d.source,d.target,d.point)||(k=e.datagrid("getPanel"),l=k.find("div.datagrid-view"),m=l.find("div.datagrid-view1"),n=l.find("div.datagrid-view2"),o=m.find("table.datagrid-htable tr.datagrid-header-row"),p=n.find("table.datagrid-htable tr.datagrid-header-row"),q=m.find("table.datagrid-btable tr.datagrid-row"),r=n.find("table.datagrid-btable tr.datagrid-row"),s=g?o.find("td[field="+d.source+"]"):p.find("td[field="+d.source+"]"),t=h?o.find("td[field="+d.target+"]"):p.find("td[field="+d.target+"]"),u=g?q:r,v=h?q:r,u.length==v.length&&(t[d.point](s),v.each(function(b){var e=a(this).find("td[field="+d.target+"]"),f=a(u[b]).find("td[field="+d.source+"]");e[d.point](f)}),w=e.datagrid("getColumnOption",d.source),x=e.datagrid("getColumnOption",d.target),y=g?f.frozenColumns[0]:f.columns[0],z=h?f.frozenColumns[0]:f.columns[0],A=f._extensionsDatagrid?f._extensionsDatagrid:f._extensionsDatagrid={},a.array.remove(y,w),B=a.array.indexOf(z,x),B>-1&&a.array.insert(z,"before"==d.point?B:B+1,w),e.datagrid("fixColumnSize"),g&&(h||(B=a.array.indexOf(A.fields,d.target),a.array.insert(A.fields,"before"==d.point?B:B+1,d.source),a.array.insert(A.fieldOptions,"before"==d.point?B:B+1,w),a.array.insert(A.fieldOptionsBackup,"before"==d.point?B:B+1,a.extend({},w)))),g||(B=a.array.indexOf(A.fields,d.source),h?(a.array.removeAt(A.fields,B),a.array.removeAt(A.fieldOptions,B),a.array.removeAt(A.fieldOptionsBackup,B)):(C=A.fieldOptions[B],D=A.fieldOptionsBackup[B],a.array.removeAt(A.fields,B),a.array.removeAt(A.fieldOptions,B),a.array.removeAt(A.fieldOptionsBackup,B),B=a.array.indexOf(A.fields,d.target),a.array.insert(A.fields,"before"==d.point?B:B+1,d.source),a.array.insert(A.fieldOptions,"before"==d.point?B:B+1,C),a.array.insert(A.fieldOptionsBackup,"before"==d.point?B:B+1,D))),a.isFunction(f.onMoveColumn)&&f.onMoveColumn.call(c,d.source,d.target,d.point))))))},w=function(b,c){var d,e,f;c&&c.field&&c.point&&(a.array.contains(["before","after"],c.point)||(c.point="before"),d=a.util.parseJquery(b),e=d.datagrid("getColumnFields","all"),f=a.array.indexOf(e,c.field),-1==f||"before"==c.point&&0==f||"after"==c.point&&f==e.length-1||(b=e["before"==c.point?f-1:f+1],d.datagrid("moveColumn",{source:c.field,target:b,point:c.point})))},x=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("options"),f=e._extensionsDatagrid?e._extensionsDatagrid:e._extensionsDatagrid={};a.isFunction(e.onBeforeDeleteColumn)&&0==e.onBeforeDeleteColumn.call(b,c)||(z(e,c,f),d.datagrid("getColumnDom",{field:c,header:!0}).remove(),a.isFunction(e.onDeleteColumn)&&e.onDeleteColumn.call(b,c))},y=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getColumnOption",c);return e&&d.datagrid("deleteColumn",c),e},z=a.fn.datagrid.extensions.removeField=function(c,d,e){var f,g,h=-1,i=-1;a.array.likeArray(c.frozenColumns)&&(a.each(c.frozenColumns,function(b,c){if(a.array.likeArray(this))a.each(this,function(a,b){return b.field==d?(i=a,!1):void 0});else if(c.field==d)return i=b,!1;return i>-1?(h=b,!1):void 0}),i>-1&&(g=!0)),g==b&&a.array.likeArray(c.columns)&&(a.each(c.columns,function(b,c){if(a.array.likeArray(this))a.each(this,function(a,b){return b.field==d?(i=a,!1):void 0});else if(c.field==d)return i=b,!1;return i>-1?(h=b,!1):void 0}),i>-1&&(g=!1)),i>-1&&(f=g?c.frozenColumns:c.columns,f=h>-1?f[h]:f,a.array.removeAt(f,i),index=a.array.indexOf(e.fields,d),a.array.remove(e.fields,d),a.array.removeAt(e.fieldOptions,index),a.array.removeAt(e.fieldOptionsBackup,index))},A=function(b){var c=a.util.parseJquery(b),d=c.datagrid("options");return d.columns&&d.columns.length>1&&d.columns[1].length>0||d.frozenColumns&&d.frozenColumns.length>1&&d.frozenColumns[1].length>0},B=function(c,d){var g,e=a.util.parseJquery(c),f=e.datagrid("getRows");return a.isFunction(d)?g=a.array.filter(f,d):a.array.likeArray(d)&&!a.util.isString(d)?(g=a.array.map(d,function(a){return C(c,a,e,f)}),g=a.array.filter(g,function(a){return a!=b&&null!=a})):g=[C(c,d,e,f)],g},C=function(b,c,d,e){var f=d||a.util.parseJquery(b),h=(e||f.datagrid("getRows"),f.datagrid("options"));return a.array.first(e,a.isFunction(c)?c:function(a){return a[h.idField]==c})},D=a.fn.datagrid.methods.deleteRow,E=function(b,c){var f,g,h,d=a.util.parseJquery(b),e=a.isFunction(c);e?(g=d.datagrid("getRows"),h=a.array.first(g,c),h&&D.call(d,d,h)):(f=a.isNumeric(c)?c:d.datagrid("getRowIndex",c),a.isNumeric(f)&&f>-1&&D.call(d,d,f))},F=function(b,c){var e,f,d=a.array.likeArray(c)&&!a.util.isString(c);return d?(a.each(c,function(a,c){E(b,c)}),void 0):(a.isFunction(c)&&(e=a.util.parseJquery(b),f=e.datagrid("getRows"),a.each(f,function(a){if(1==c.call(this,this,a,f)){var d=e.datagrid("getRowIndex",this);D.call(e,e,d)}})),void 0)},G=function(b,c){if(c&&c.field&&c.title){var d=a.util.parseJquery(b),e=d.datagrid("getColumnOption",c.field),f=c.field,g=c.title,h=d.datagrid("getPanel"),i=h.find("div.datagrid-view div.datagrid-header tr.datagrid-header-row td[field="+f+"]");i.length&&(i.find("div.datagrid-cell span:first").html(g),e.title=g)}},H=function(c,d){var f,g,h,i,j,k,l;d&&d.field&&d.width&&a.isNumeric(d.width)&&(a.data(c,"datagrid"),f=a.util.parseJquery(c),g=f.datagrid("options"),h=f.datagrid("getColumnOption",d.field),i=d.field,j=d.width,k=f.datagrid("getPanel").find("div.datagrid-view div.datagrid-header tr.datagrid-header-row td[field="+i+"] div.datagrid-cell"),k.length&&(l=k._outerWidth()-parseInt(k[0].style.width),k.css("height",""),h.width=j,h.boxWidth=j-l,h.auto=b,k.width(h.boxWidth),f.datagrid("fixColumnSize",i),f.datagrid("fitColumns"),g.onResizeColumn.call(c,i,j)))},I=function(b,c){var d,e,f,g,h,i,j,k;c=c||{},c=a.extend({sortName:null,sortOrder:"asc"},c),d=a.util.parseJquery(b),e=a.data(b,"datagrid"),f=e.options,g=d.datagrid("getColumnOption",c.sortName),g&&!a.isEmptyObject(g)&&g.sortable&&!e.resizing&&(f.sortName=c.sortName,f.sortOrder=c.sortOrder,h="datagrid-sort-"+f.sortOrder,i=d.datagrid("getPanel").find(".datagrid-view .datagrid-header td div.datagrid-cell"),j=d.datagrid("getPanel").find(".datagrid-view .datagrid-header td[field='"+c.sortName+"'] div.datagrid-cell"),i.length&&j.length&&(i.removeClass("datagrid-sort-asc datagrid-sort-desc"),j.addClass(h),f.remoteSort?d.datagrid("reload"):(k=a.data(b,"datagrid").data,d.datagrid("loadData",k)),f.onSortColumn.call(b,f.sortName,f.sortOrder)))},a.fn.datagrid.extensions.parseOffset=function(b){var c={enable:b?!0:!1};return c.enable&&a.extend(c,b),c.width=a.isNumeric(c.width)?c.width:0,c.height=a.isNumeric(c.height)?c.height:0,c},J=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("options"),f=e._extensionsDatagrid?e._extensionsDatagrid:e._extensionsDatagrid={};e.offset=f.offset=a.fn.datagrid.extensions.parseOffset(c),f.offset&&f.offset.enable&&(a.isFunction(f.offsetFunction)||(f.offsetFunction=function(){if(f.offset.enable){var b=a.util.windowSize();d.datagrid("resize",{width:b.width+f.offset.width,height:b.height+f.offset.height})}},a(window).resize(f.offsetFunction)),f.offsetFunction())},K=function(b,c){if(a.string.isNullOrEmpty(c))return a();var d=a.util.parseJquery(b),e=d.datagrid("getPanel"),f=!a.string.isString(c),g=f?c.field:c,h=f?c.header:!1,i=e.find("div.datagrid-view tr.datagrid-row td[field="+g+"]");return h&&(i=i.add(e.find("div.datagrid-view tr.datagrid-header-row td[field="+g+"]"))),i},L=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getRows");return a.array.map(e,function(a){return a[c]})},M=function(b,c){if(!a.isNumeric(c)||0>c)return a();var d=a.util.parseJquery(b),e=d.datagrid("getPanel");return e.find(".datagrid-view .datagrid-body tr.datagrid-row[datagrid-row-index="+c+"]")},N=function(c,d){if(!a.isNumeric(d)||0>d)return b;var e=a.util.parseJquery(c),f=e.datagrid("getRows");return f[d]},O=function(b,c){if(!c||!c.field||!a.isNumeric(c.index)||c.index<0)return a();var d=a.util.parseJquery(b),e=d.datagrid("getRowDom",c.index);return e.find("td[field="+c.field+"] .datagrid-cell")},P=function(b,c){if(c&&c.field&&a.isNumeric(c.index)&&!(c.index<0)){var d=a.util.parseJquery(b),e=d.datagrid("getRowData",c.index);return e[c.field]}},Q=function(c,d){var e=a.util.parseJquery(c),f=e.datagrid("getCellDom",d);return f&&f.length?f.text():b},R=a.fn.datagrid.methods.getColumnFields,S=function(c,d){var e=a.util.parseJquery(c);return null==d||d==b||a.util.isBoolean(d)?R.call(e,e,d):a.util.isString(d)?a.array.merge([],R.call(e,e,!0),R.call(e,e,!1)):void 0},T=function(b,c){var f,g,d=a.util.parseJquery(b),e=d.datagrid("getColumnFields","all");return a.array.contains(e,c)?(f=d.datagrid("getRows"),g=a.array.clone(f),a.array.distinct(g,function(a,b){return a[c]==b[c]}),g):[]},U=function(b,c){var f,d=a.util.parseJquery(b),e=d.datagrid("getColumnFields","all");return a.array.contains(e,c)?(f=d.datagrid("getColumnData",c),a.array.distinct(f,function(a,b){return a==b}),f):[]},V=function(b,c){var d=a.util.parseJquery(b),e=S(b,c);return a.array.map(e,function(a){return d.datagrid("getColumnOption",a)})},W=function(b,c){var d=V(b,c);return a.array.filter(d,function(a){return a.hidden?!0:!1})},X=function(b,c){var d=V(b,c);return a.array.filter(d,function(a){return a.hidden?!1:!0})},Y=function(b,c){var d=W(b,c);return a.array.map(d,function(a){return a.field})},Z=function(b,c){var d=X(b,c);return a.array.map(d,function(a){return a.field})},$=function(c,d,e,f,g,h,i){var n,o,p,j=e||a.util.parseJquery(c),k=g||j.datagrid("getRows"),l=a.isFunction(d)?C(c,d,j,k):d,m=j.datagrid("getRowIndex",l);i=null==i||i==b||1==i?!0:!1,m>-1&&(n=f||j.datagrid("options"),o=j.datagrid("getRowData",m),p=h||(n._extensionsDatagrid?n._extensionsDatagrid:n._extensionsDatagrid={}),p.filterData=a.isArray(p.filterData)?p.filterData:p.filterData=[],j.datagrid("getRowDom",m).show(),a.array.remove(p.filterData,o),i&&tb(j,n,p,k))},_=function(c,d,e,f,g,h,i){var n,o,p,j=e||a.util.parseJquery(c),k=g||j.datagrid("getRows"),l=a.isFunction(d)?C(c,d,j,k):d,m=j.datagrid("getRowIndex",l);i=null==i||i==b||1==i?!0:!1,m>-1&&(n=f||j.datagrid("options"),o=j.datagrid("getRowData",m),p=h||(n._extensionsDatagrid?n._extensionsDatagrid:n._extensionsDatagrid={}),p.filterData=a.isArray(p.filterData)?p.filterData:[],j.datagrid("unselectRow",m).datagrid("uncheckRow",m).datagrid("getRowDom",m).hide(),a.array.attach(p.filterData,o),i&&tb(j,n,p,k))},ab=function(b,c){var g,i,j,d=a.util.parseJquery(b),e=d.datagrid("options"),f=d.datagrid("getRows"),h=e._extensionsDatagrid?e._extensionsDatagrid:e._extensionsDatagrid={};c===!0?(h.filterData=[],i=d.datagrid("getPanel"),j=i.find("div.datagrid-header-filter-item-icon"),i.find(".datagrid-view .datagrid-body tr.datagrid-row").show(),wb(j,"tree-checkbox1")):g=a.isFunction(c)?a.array.filter(f,c):a.array.likeArray(c)&&!a.util.isString(c)?c:[c],g&&(a.each(g,function(a,c){$(b,c,d,e,f,h,!1)}),tb(d,e,h,f))},bb=function(b,c){var g,i,j,d=a.util.parseJquery(b),e=d.datagrid("options"),f=d.datagrid("getRows"),h=e._extensionsDatagrid?e._extensionsDatagrid:e._extensionsDatagrid={};c===!0?(d.datagrid("unselectAll").datagrid("uncheckAll"),h.filterData=a.array.clone(f),i=d.datagrid("getPanel"),j=i.find("div.datagrid-header-filter-item-icon"),i.find(".datagrid-view .datagrid-body tr.datagrid-row").hide(),wb(j,"tree-checkbox0")):g=a.isFunction(c)?a.array.filter(f,c):a.array.likeArray(c)&&!a.util.isString(c)?c:[c],g&&(a.each(g,function(a,c){_(b,c,d,e,f,h,!1)}),tb(d,e,h,f))},cb=function(b){var c=a.util.parseJquery(b),d=c.datagrid("options"),e=d._extensionsDatagrid?d._extensionsDatagrid:d._extensionsDatagrid={};return e.filterData},db=function(b){var c=a.util.parseJquery(b),d=c.datagrid("options"),e=c.datagrid("getRows"),f=d._extensionsDatagrid?d._extensionsDatagrid:d._extensionsDatagrid={},g=a.isArray(f.filterData)?f.filterData:[];return a.array.filter(e,function(b){return a.array.contains(g,b)?!1:!0})},eb=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("options"),f=e._extensionsDatagrid?e._extensionsDatagrid:e._extensionsDatagrid={};c?(e.columnFilter=c,mb(d,e,f)):(nb(d,e),e.columnFilter=c)},fb=function(b,c){var e,f,g,h,i,d=a.util.parseJquery(b);return a.util.isBoolean(c)?(d.datagrid(c?"showRows":"hideRows",!0),void 0):(c&&c.field&&(e=c.field,f=c.value,g=a.array.likeArray(f)&&!a.util.isString(f),h=g?function(b){return a.array.contains(f,b[e])}:function(a){return f==a[e]},i=d.datagrid("findRows",h),d.datagrid(c.selected?"showRows":"hideRows",i)),void 0)},gb=function(b,c){var d=a.util.parseJquery(b),e=a.data(d[0],"datagrid");e.options,e.highlightField&&d.datagrid("getColumnDom",{field:e.highlightField,header:!0}).removeClass("datagrid-row-over"),d.datagrid("getColumnDom",{field:c,header:!0}).filter(function(){return!a(this).parent().hasClass("datagrid-row-selected")}).addClass("datagrid-row-over"),e.highlightField=c},hb=function(b,c){var f,g,k,d=a.util.parseJquery(b),e=d.datagrid("getPanel"),h=c,i=!1,j=!0;a.isPlainObject(c)?(h=c.value,g=c.field,i=c.regular,j=c.ignoreCase,f=e.find("div.datagrid-body tr.datagrid-row td["+(g?"field="+g:"field")+"] div.datagrid-cell")):f=e.find("div.datagrid-body tr.datagrid-row td[field] div.datagrid-cell"),k=i?new RegExp(h,j?"gm":"igm"):h,f.each(function(){var c,b=a(this);b.find("span.datagrid-cell-hightlight").replaceWith(function(){return a(this).text()}),h&&(c=b.html(),c&&b.html(a.string.replaceAll(c,h,"<span class='datagrid-cell-hightlight'>"+h+"</span>")))})},ib=function(b,c){c=a.string.toBoolean(c),alert("导出"+(c?"全部":"当前页")+"数据")},jb=a.fn.datagrid.extensions.initColumnExtendProperty=function(c){(null==c.tooltip||c.tooltip==b)&&(c.tooltip=!1),null!=c.filterable&&c.filterable!=b&&a.util.isBoolean(c.filterable)||(c.filterable=!0),null!=c.hidable&&c.hidable!=b&&a.util.isBoolean(c.hidable)||(c.hidable=!0),null!=c.filter&&c.filter!=b&&a.util.isString(c.filter)||(c.filter="checkbox"),null!=c.precision&&c.precision!=b&&a.isNumeric(c.precision)||(c.precision=1),null!=c.step&&c.step!=b&&a.isNumeric(c.step)||(c.step=1)},kb=a.fn.datagrid.extensions.initColumnExtendProperties=function(b,c){if(!c._initializedExtendProperties){var d=b.datagrid("getColumns","all");a.each(d,function(){jb(this)}),c._initializedExtendProperties=!0}},lb=a.fn.datagrid.extensions.initRowDndExtensions=function(a,b){b=b||a.datagrid("options"),b.dndRow&&a.datagrid("enableRowDnd")},a.fn.datagrid.extensions.parseHeaderContextMenuMap=function(b,c,d,e,f){return a.array.map(e,function(e){if(!e||a.util.isString(e))return e;var h=a.extend({},e);return h.id=a.isFunction(e.id)?e.id.call(h,b,c,d,f):e.id,h.text=a.isFunction(e.text)?e.text.call(h,b,c,d,f):e.text,h.iconCls=a.isFunction(e.iconCls)?e.iconCls.call(h,b,c,d,f):e.iconCls,h.disabled=a.isFunction(e.disabled)?e.disabled.call(h,b,c,d,f):e.disabled,h.hideOnClick=a.isFunction(e.hideOnClick)?e.hideOnClick.call(h,b,c,d,f):e.hideOnClick,h.onclick=a.isFunction(e.onclick)?function(a,b,g){e.onclick.call(this,a,c,d,f,b,g)}:e.onclick,h.handler=a.isFunction(e.handler)?function(a,b,g){e.handler.call(this,a,c,d,f,b,g)}:e.handler,h.children&&h.children.length&&(h.children=a.fn.datagrid.extensions.parseHeaderContextMenuMap(b,c,d,h.children,f)),h})},a.fn.datagrid.extensions.parseRowContextMenuMap=function(b,c,d,e,f,g){return a.array.map(f,function(f){if(!f||a.util.isString(f))return f;var i=a.extend({},f);return i.id=a.isFunction(f.id)?f.id.call(i,b,c,d,e,g):f.id,i.text=a.isFunction(f.text)?f.text.call(i,b,c,d,e,g):f.text,i.iconCls=a.isFunction(f.iconCls)?f.iconCls.call(i,b,c,d,e,g):f.iconCls,i.disabled=a.isFunction(f.disabled)?f.disabled.call(i,b,c,d,e,g):f.disabled,i.hideOnClick=a.isFunction(f.hideOnClick)?f.hideOnClick.call(i,b,c,d,e,g):f.hideOnClick,i.onclick=a.isFunction(f.onclick)?function(a,b,h){f.onclick.call(this,a,c,d,e,g,b,h)}:f.onclick,i.handler=a.isFunction(f.handler)?function(a,b,h){f.handler.call(this,a,c,d,e,g,b,h)}:f.handler,i.children&&i.children.length&&(i.children=a.fn.datagrid.extensions.parseRowContextMenuMap(b,c,d,e,i.children,g)),i})},a.fn.datagrid.extensions.parseContextMenuEventData=function(b,c,d){var e=a.fn.datagrid.extensions.parseRemoteQueryParams(c),f=a.fn.datagrid.extensions.parsePaginationParams(b,c);return a.extend({},e,f,{e:d,grid:b})},a.fn.datagrid.extensions.parsePaginationParams=function(b,c){var e,f,g,h,d={};return c.pagination&&(e=b.datagrid("getPager"),f=e.pagination("options"),g=f.total,h=Math.ceil(parseFloat(g)/parseFloat(f.pageSize)),a.extend(d,{pager:e,total:g,pageCount:h})),d},a.fn.datagrid.extensions.parseRemoteQueryParams=function(b){var c=a.extend({},b.queryParams);return b.pagination&&a.extend(c,{page:b.pageNumber,rows:b.pageSize}),b.sortName&&a.extend(c,{sort:b.sortName,order:b.sortOrder}),c=a.fn.datagrid.extensions.parsePagingQueryParams(b,c)},Lb=function(b,c){var d=b.datagrid("getRows");b.datagrid("getPanel").find("div.datagrid-view div.datagrid-body table.datagrid-btable tr.datagrid-row").each(function(){var e=a(this),f=parseInt(e.attr("datagrid-row-index")),g=d[f];Mb(b,c,f,g,e)})},Mb=function(b,c,d,e,f){function h(){var e=b.datagrid("getColumns","all"),f=a("<table></table>").css({padding:"5px"});return a.each(e,function(a,c){if(c&&c.field&&c.title){var e=b.datagrid("getCellDisplay",{field:c.field,index:d});f.append("<tr><td style='text-align: right; width: 150px;'>"+c.title+":</td><td style='width: 250px;'>"+e+"</td></tr>")}}),f}if(f=f||b.datagrid("getRowDom",d),c.rowTooltip){var g=function(){var g=a(this),i=a.isFunction(c.rowTooltip)?c.rowTooltip.call(f,d,e):h(e);g.tooltip("update",i)};f.each(function(){a.easyui.tooltip.init(this,{onShow:g})})}else f.children("td[field]").each(function(){var h,i,c=a(this),f=c.attr("field"),g=b.datagrid("getColumnOption",f);g&&g.tooltip&&(h=c.find("div.datagrid-cell"),i=function(){var c=a(this),i=a.isFunction(g.tooltip)?g.tooltip.call(h,e[f],d,e):e[f];c.tooltip("update",i)},a.easyui.tooltip.init(h,{onShow:i}))})},Nb=function(b,c,d){var e,f,g,h,i,j,l,m,n,o,p;c.extEditing&&(e=b.datagrid("getRowDom",d),e.length&&(f=b.datagrid("getPanel").find("div.datagrid-view"),g=f.find("div.datagrid-view1"),h=f.find("div.datagrid-view2"),i=h.find("div.datagrid-body"),j=g.outerWidth(),f.position(),l=p>0?p:0,i.css("position","relative"),m=e.outerHeight(),n=e.position().top+m+i.scrollTop()-h.find("div.datagrid-header").outerHeight(),o=a("<div></div>").addClass("dialog-button datagrid-rowediting-panel").appendTo(i).css("top",n).attr("datagrid-row-index",d),a("<a></a>").linkbutton({plain:!1,iconCls:"icon-ok",text:"保存"}).appendTo(o).click(function(){b.datagrid("endEdit",d)}),a("<a></a>").linkbutton({plain:!1,iconCls:"icon-cancel",text:"取消"}).appendTo(o).click(function(){b.datagrid("cancelEdit",d)}),p=(c.width-o.outerWidth())/2-j,l=p>0?p:0,o.css("left",l)))},Ob=function(a,b,c){b=b||a.datagrid("getPanel").find("div.datagrid-view div.datagrid-view2 div.datagrid-body"),b.find("div.datagrid-rowediting-panel[datagrid-row-index="+c+"]").remove()},Pb=function(a,b,c){b.extEditing&&(body=a.datagrid("getPanel").find("div.datagrid-view div.datagrid-view2 div.datagrid-body"),Ob(a,body,c))},Qb=function(a,b,c){var d=b._extensionsDatagrid?b._extensionsDatagrid:b._extensionsDatagrid={};b.singleEditing&&a.datagrid("endEdit",d.lastEditingIndex),d.lastEditingIndex=c},Rb=a.fn.datagrid.extensions.initExtensions=function(b,c){function f(){kb(b,d)}function g(){b.datagrid("setOffset",c.offset)}function h(){Ab(b,c,d),Bb(b,c,d),Cb(b,c,d)}function i(){Eb(b,c,d)}var e,j,d=c._extensionsDatagrid?c._extensionsDatagrid:c._extensionsDatagrid={};d._initialized||(e=b.datagrid("getColumnFields",!1),d.fields=a.array.filter(e,function(a){return b.datagrid("getColumnOption",a).title?!0:!1}),d.fieldOptions=a.array.map(d.fields,function(a){return b.datagrid("getColumnOption",a)}),d.fieldOptionsBackup=a.array.map(d.fieldOptions,function(b){return a.extend({},b)}),d.filterData=[],f(),g(),h(),i(),j=b.datagrid("getRows"),j&&j.length||mb(b,c,d),d._initialized=!0)},a.fn.datagrid.extensions.parseOrderbyParams=function(b,c){return b=a.string.isNullOrWhiteSpace(b)?"":a.trim(b),c=a.string.isNullOrWhiteSpace(c)?"":a.trim(c),c=c.toLowerCase(),"asc"!=c&&"desc"!=c&&(c="asc"),a.trim(b+" "+c)},a.fn.datagrid.extensions.parsePagingQueryParams=function(b,c){var d=a.util.parseMapFunction(c);return b.pagination&&(d.pageNumber=d.page,d.pageSize=d.rows,d.pageIndex=d.pageNumber-1),d.orderby=a.fn.datagrid.extensions.parseOrderbyParams(d.sort,d.order),d},Sb=a.fn.datagrid.extensions.clearFilterData=function(a){var b=a._extensionsDatagrid?a._extensionsDatagrid:a._extensionsDatagrid={};b.filterData=[]},Tb=a.fn.datagrid.extensions.loader=function(b,c,d){var e=a.util.parseJquery(this),f=e.datagrid("options");return Rb(e,f),f.url?(b=a.fn.datagrid.extensions.parsePagingQueryParams(f,b),a.ajax({type:f.method,url:f.url,data:b,dataType:"json",success:function(a){Sb(f),c(a)},error:function(){d.apply(this,arguments)}}),void 0):!1},Ub=function(b){return b?a.isArray(b)?{total:b.length,rows:b}:b:{total:0,rows:[]}},Vb=a.fn.datagrid.defaults.onLoadSuccess,Wb=a.fn.datagrid.extensions.onLoadSuccess=function(){a.isFunction(Vb)&&Vb.apply(this,arguments);var c=a.util.parseJquery(this),d=c.datagrid("options"),e=d._extensionsDatagrid?d._extensionsDatagrid:d._extensionsDatagrid={};mb(c,d,e),lb(c,d),Lb(c,d)},Xb=a.fn.datagrid.defaults.onResizeColumn,Yb=a.fn.datagrid.extensions.onResizeColumn=function(b){var d,e,f,g,h;a.isFunction(Xb)&&Xb.apply(this,arguments),d=a.util.parseJquery(this),e=d.datagrid("options"),e.columnFilter&&(f=d.datagrid("getPanel"),g=d.datagrid("getColumnOption",b),h=f.find("div.datagrid-header-filter-container[field="+b+"]"),h.width(g.width))},Zb=a.fn.datagrid.defaults.onBeforeEdit,$b=a.fn.datagrid.extensions.onBeforeEdit=function(b){a.isFunction(Zb)&&Zb.apply(this,arguments);var d=a.util.parseJquery(this),e=d.datagrid("options");Nb(d,e,b),Qb(d,e,b),d.datagrid("getPanel").find("div.datagrid-view div.datagrid-body table.datagrid-btable tr.datagrid-row").draggable("disable")},_b=a.fn.datagrid.defaults.onAfterEdit,ac=a.fn.datagrid.extensions.onAfterEdit=function(b,c){a.isFunction(_b)&&_b.apply(this,arguments);var e=a.util.parseJquery(this),f=e.datagrid("options"),g=f._extensionsDatagrid?f._extensionsDatagrid:f._extensionsDatagrid={};Pb(e,f,b),mb(e,f,g),lb(e,f),Mb(e,f,b,c)},bc=a.fn.datagrid.defaults.onCancelEdit,cc=a.fn.datagrid.extensions.onCancelEdit=function(b,c){a.isFunction(bc)&&bc.apply(this,arguments);var d=a.util.parseJquery(this),e=d.datagrid("options");Pb(d,e,b),lb(d,e),Mb(d,e,b,c)},dc=a.fn.datagrid.extensions.methods={updateRow:function(a,b){return a.each(function(){f(this,b)})},appendRow:function(a,b){return a.each(function(){g(this,b)})},insertRow:function(a,b){return a.each(function(){h(this,b)})},isChecked:function(a,b){return i(a[0],b)},isSelected:function(a,b){return j(a[0],b)},freezeColumn:function(a,b){return a.each(function(){k(this,b)})},unfreezeColumn:function(a,b){return a.each(function(){l(this,b)})},moveRow:function(a,b){return a.each(function(){m(this,b)})},shiftRow:function(a,b){return a.each(function(){n(this,b)})},nextRow:function(a,b){return o(a[0],b)},prevRow:function(a,b){return p(a[0],b)},popRow:function(a,b){return q(a[0],b)},enableRowDnd:function(a){return a.each(function(){r(this)})},disableRowDnd:function(a){return a.each(function(){s(this)})},moveColumn:function(a,b){return a.each(function(){v(this,b)})},shiftColumn:function(a,b){return a.each(function(){w(this,b)})},nextColumn:function(a,b){return t(a[0],b)},prevColumn:function(a,b){return u(a[0],b)},deleteColumn:function(a,b){return a.each(function(){x(this,b)})},popColumn:function(a){return y(a[0],param)},getColumnDom:function(a,b){return K(a[0],b)},getColumnData:function(a,b){return L(a[0],b)},getRowDom:function(a,b){return M(a[0],b)},getRowData:function(a,b){return N(a[0],b)},getCellDom:function(a,b){return O(a[0],b)},getCellData:function(a,b){return P(a[0],b)},getCellDisplay:function(a,b){return Q(a[0],b)},getColumnFields:function(a,b){return S(a[0],b)},getDistinctRows:function(a,b){return T(a[0],b)},getDistinctColumnData:function(a,b){return U(a[0],b)},getColumns:function(a,b){return V(a[0],b)},getHiddenColumns:function(a,b){return W(a[0],b)},getVisibleColumns:function(a,b){return X(a[0],b)},getHiddenColumnFields:function(a,b){return Y(a[0],b)},getVisibleColumnFields:function(a,b){return Z(a[0],b)},showRow:function(a,b){return a.each(function(){$(this,b)})},hideRow:function(a,b){return a.each(function(){_(this,b)})},showRows:function(a,b){return a.each(function(){ab(this,b)})},hideRows:function(a,b){return a.each(function(){bb(this,b)})},getHiddenRows:function(a){return cb(a[0])},getVisibleRows:function(a){return db(a[0])},highlightColumn:function(a,b){return a.each(function(){gb(this,b)})},livesearch:function(a,b){return a.each(function(){hb(this,b)})},hasMuliRowHeader:function(a){return A(a[0])},findRow:function(a,b){return C(a[0],b)},findRows:function(a,b){return B(a[0],b)},deleteRow:function(a,b){return a.each(function(){E(this,b)})},deleteRows:function(a,b){return a.each(function(){F(this,b)})},sort:function(a,b){return a.each(function(){I(this,b)})},setColumnTitle:function(a,b){return a.each(function(){G(this,b)})},setColumnWidth:function(a,b){return a.each(function(){H(this,b)})},setOffset:function(a,b){return a.each(function(){J(this,b)})},setColumnFilter:function(a,b){return a.each(function(){eb(this,b)})},columnFilterSelect:function(a,b){return a.each(function(){fb(this,b)})},exportExcel:function(a,b){return a.each(function(){ib(this,b)})}},ec=a.fn.datagrid.extensions.defaults={offset:null,loadFilter:Ub,autoBindDblClickRow:!0,dblClickRowMenuIndex:0,exportMenu:!1,selectOnRowContextMenu:!0,hideDisabledMenu:!1,headerContextMenu:null,rowContextMenu:null,enableHeaderContextMenu:!0,enableRowContextMenu:!0,moveMenu:!1,pagingMenu:!1,dndRow:!1,rowTooltip:!1,extEditing:!0,autoEditing:!1,singleEditing:!0,columnFilter:null,loader:Tb,onLoadSuccess:Wb,onResizeColumn:Yb,onBeforeEdit:$b,onAfterEdit:ac,onCancelEdit:cc,onBeforeDeleteColumn:function(){},onDeleteColumn:function(){},onBeforeMoveColumn:function(){},onMoveColumn:function(){},onBeforeDrop:function(){},onDrop:function(){},onBeforeDrag:function(){},onStartDrag:function(){},onStopDrag:function(){},onDragEnter:function(){},onDragOver:function(){},onDragLeave:function(){},onBeforeUpdateRow:function(){},onUpdateRow:function(){},onBeforeAppendRow:function(){},onAppendRow:function(){},onBeforeInsertRow:function(){},onBeforeRow:function(){}},a.extend(a.fn.datagrid.defaults,ec),a.extend(a.fn.datagrid.methods,dc),fc=".datagrid-rowediting-panel { position: absolute; display: block; border: 1px solid #ddd; padding: 5px 5px; }.datagrid-body td.datagrid-header-cell-top { border-top-color: red; border-top-width: 2px; border-top-style: dotted; }.datagrid-body td.datagrid-header-cell-bottom { border-bottom-color: red; border-bottom-width: 2px; border-bottom-style: dotted; }.datagrid-cell-hightlight { font-weight: bold; background-color: Yellow; }.datagrid-header-cell-arrow { display: inline-block; float: right; cursor: pointer; border-left-style: dotted; border-left-width: 0px; filter: alpha(opacity=0); opacity: 0; }.datagrid-header-cell-arrow-show { border-left-width: 1px; filter: alpha(opacity=80); opacity: 0.8; }.datagrid-header-filter { overflow: auto; }.datagrid-header-filter { text-align: center; }.datagrid-header-filter-top { vertical-align: bottom; }.datagrid-header-filter-bottom { vertical-align: bottom; }.datagrid-header-filter-cell { white-space: nowrap; }.datagrid-header-filter-line { border-width: 0px; border-top-width: 1px; border-style: dotted; border-color: #ccc; margin-top: 3px; margin-bottom: 3px; }.datagrid-header-filter-container { padding-top: 5px; overflow: auto; font-size: 11px; text-align: left; }.datagrid-header-filter-livebox-text { margin-left: 10px; margin-top: 10px; overflow: auto; font-size: 11px; text-align: left; }.datagrid-header-filter-livebox { margin-left: 10px; width: 60px; height: 12px; font-size: 11px; }.datagrid-header-filter-item { overflow: hidden; padding: 0px; margin: 0px; cursor: pointer; white-space: nowrap; margin: 2px; }.datagrid-header-filter-item:hover { filter: alpha(opacity=60); opacity: 0.6; }.datagrid-header-filter-item-text { padding-left: 20px; float: left; }.datagrid-header-filter-item-icon { left: 2px; top: 50%; width: 16px; height: 16px; margin-top: -3px; }.datagrid-header-filter-itemwrap { overflow: hidden; padding-left: 5px; white-space: nowrap; height: 20px; }.datagrid-header-filter-slider { }.datagrid-header-filter-sliderwrap { overflow: hidden; padding-left: 30px; padding-top: 15px; }.datagrid-header-filter-sliderwrap .slider-rulelabel span { font-size: 11px; }.datagrid-header-filter-numeric { width: 60px; height: 12px; font-size: 11px; }",a.util.addCss(fc)}(jQuery);