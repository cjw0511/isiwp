/**
* jQuery EasyUI 1.3.3
* Copyright (c) 2009-2013 www.jeasyui.com. All rights reserved.
*
* Licensed under the GPL or commercial licenses
* To use it on other terms please contact us: info@jeasyui.com
* http://www.gnu.org/licenses/gpl.txt
* http://www.jeasyui.com/license_commercial.php
*
* jQuery EasyUI menu Extensions 1.0 beta
* jQuery EasyUI menu 组件扩展
* jeasyui.extensions.menu.js
* 二次开发 陈建伟
* 最近更新：2013-07-24
*
* 依赖项：
*   1、jquery.jdirk.js v1.0 beta late
*   2、jeasyui.extensions.js v1.0 beta late
*
* Copyright (c) 2013 ChenJianwei personal All rights reserved.
* http://www.chenjianwei.org
*/
!function($,undefined){function init(a){function e(b){var c=[];return b.addClass("menu"),c.push(b),b.hasClass("menu-content")||b.children("div").each(function(){var d,b=$(this).children("div");b.length&&(b.insertAfter(a),this.submenu=b,d=e(b),c=c.concat(d))}),c}function f(b){var c=$.parser.parseOptions(b[0],["width"]).width;b.hasClass("menu-content")?b[0].originalWidth=c||b._outerWidth():(b[0].originalWidth=c||0,b.children("div").each(function(){var c,d,b=$(this);b.hasClass("menu-sep")||(c=$.extend({hideOnClick:!0},$.parser.parseOptions(this,["name","iconCls","href",{hideOnClick:"boolean"}]),{disabled:b.attr("disabled")?!0:undefined}),b.attr({name:c.name||"",href:c.href||"",hideOnClick:c.hideOnClick}),d=b.addClass("menu-item").html(),b.empty().append($('<div class="menu-text"></div>').html(d)),c.iconCls&&$('<div class="menu-icon"></div>').addClass(c.iconCls).appendTo(b),c.disabled&&setDisabled(a,b[0],!0),b[0].submenu&&$('<div class="menu-rightarrow"></div>').appendTo(b),bindMenuItemEvent(a,b))}),$('<div class="menu-line"></div>').prependTo(b)),setMenuWidth(a,b),b.hide(),bindMenuEvent(a,b)}var c,d,b=$(a).appendTo("body").addClass("menu-top");for($(document).unbind(".menu").bind("mousedown.menu",function(a){var b=$("body>div.menu:visible"),c=$(a.target).closest("div.menu",b);c.length||$("body>div.menu-top:visible").menu("hide")}),c=e(b),d=0;d<c.length;d++)f(c[d])}function setMenuWidth(a,b){var e,c=$.data(a,"menu").options,d=b.css("display");b.css({display:"block",left:-1e4}),b.find("div.menu-item")._outerHeight(22),e=0,b.find("div.menu-text").each(function(){e<$(this)._outerWidth()&&(e=$(this)._outerWidth())}),e+=65,b._outerWidth(Math.max(b[0].originalWidth||0,e,c.minWidth)),b.css("display",d)}function bindMenuEvent(){}function bindMenuItemEvent(a,b){b.unbind(".menu"),b.bind("click.menu",function(){var c,d,e,b=$(this);b.hasClass("menu-item-disabled")||(this.submenu||(c=b.attr("hideOnClick"),c="true"==String(c).toLowerCase()?!0:!1,c&&hideAll(a),d=b.attr("href"),d&&(location.href=d)),e=$(a).menu("getItem",this),$.data(a,"menu").options.onClick.call(a,e))}).bind("mouseenter.menu",function(){if(b.siblings().each(function(){this.submenu&&hideMenu(this.submenu),$(this).removeClass("menu-active")}),b.addClass("menu-active"),$(this).hasClass("menu-item-disabled"))return b.addClass("menu-active-disabled"),void 0;var d=b[0].submenu;d&&$(a).menu("show",{menu:d,parent:b})}).bind("mouseleave.menu",function(a){b.removeClass("menu-active menu-active-disabled");var c=b[0].submenu;c?a.pageX>=parseInt(c.css("left"))?b.addClass("menu-active"):hideMenu(c):b.removeClass("menu-active")})}function hideAll(a){var b=$.data(a,"menu");return b&&$(a).is(":visible")&&(hideMenu($(a)),b.options.onHide.call(a)),!1}function showMenu(a,b){var c,d,f,g,h,e=$(b.menu||a);e.hasClass("menu-top")?(f=$.data(a,"menu").options,c=f.left,d=f.top,b.alignTo&&(g=$(b.alignTo),c=g.offset().left,d=g.offset().top+g._outerHeight()),b.left!=undefined&&(c=b.left),b.top!=undefined&&(d=b.top),c+e.outerWidth()>$(window)._outerWidth()+$(document)._scrollLeft()&&(c=$(window)._outerWidth()+$(document).scrollLeft()-e.outerWidth()-5),d+e.outerHeight()>$(window)._outerHeight()+$(document).scrollTop()&&(d-=e.outerHeight())):(h=b.parent,c=h.offset().left+h.outerWidth()-2,c+e.outerWidth()+5>$(window)._outerWidth()+$(document).scrollLeft()&&(c=h.offset().left-e.outerWidth()+2),d=h.offset().top-3,d+e.outerHeight()>$(window)._outerHeight()+$(document).scrollTop()&&(d=$(window)._outerHeight()+$(document).scrollTop()-e.outerHeight()-5)),e.css({left:c,top:d}),e.show(0,function(){e[0].shadow||(e[0].shadow=$('<div class="menu-shadow"></div>').insertAfter(e)),e[0].shadow.css({display:"block",zIndex:$.fn.menu.defaults.zIndex++,left:e.css("left"),top:e.css("top"),width:e.outerWidth(),height:e.outerHeight()}),e.css("z-index",$.fn.menu.defaults.zIndex++),e.hasClass("menu-top")&&$.data(e[0],"menu").options.onShow.call(e[0])})}function hideMenu(a){function b(a){a.stop(!0,!0),a[0].shadow&&a[0].shadow.hide(),a.hide()}a&&(b(a),a.find("div.menu-item").each(function(){this.submenu&&hideMenu(this.submenu),$(this).removeClass("menu-active")}))}function findItem(a,b){function e(f){f.children("div.menu-item").each(function(){var f=$(a).menu("getItem",this),g=d.empty().html(f.text).text();b==$.trim(g)?c=f:this.submenu&&!c&&e(this.submenu)})}var c=null,d=$("<div></div>");return e($(a)),d.remove(),c}function setDisabled(a,b,c){var d=$(b);c?(d.addClass("menu-item-disabled"),b.onclick&&(b.onclick1=b.onclick,b.onclick=null)):(d.removeClass("menu-item-disabled"),b.onclick1&&(b.onclick=b.onclick1,b.onclick1=null))}function appendItem(target,param){var submenu,item,menu=$(target);param.parent&&(param.parent.submenu||(submenu=$('<div class="menu"><div class="menu-line"></div></div>').appendTo("body"),submenu.hide(),param.parent.submenu=submenu,$('<div class="menu-rightarrow"></div>').appendTo(param.parent)),menu=param.parent.submenu),item=$('<div class="menu-item"></div>').appendTo(menu),$('<div class="menu-text"></div>').html(param.text).appendTo(item),param.iconCls&&$('<div class="menu-icon"></div>').addClass(param.iconCls).appendTo(item),param.id&&item.attr("id",param.id),param.href&&item.attr("href",param.href),param.name&&item.attr("name",param.name),param.onclick&&("string"==typeof param.onclick?item.attr("onclick",param.onclick):item[0].onclick=eval(param.onclick)),param.handler&&(item[0].onclick=eval(param.handler)),bindMenuItemEvent(target,item),param.disabled&&setDisabled(target,item[0],!0),bindMenuEvent(target,menu),setMenuWidth(target,menu)}function removeItem(a,b){function c(a){if(a.submenu){a.submenu.children("div.menu-item").each(function(){c(this)});var b=a.submenu[0].shadow;b&&b.remove(),a.submenu.remove()}$(a).remove()}c(b)}function destroyMenu(a){$(a).children("div.menu-item").each(function(){removeItem(a,this)}),a.shadow&&a.shadow.remove(),$(a).remove()}var buildMenu,appendItemToMenu;$.fn.menu=function(a,b){return"string"==typeof a?$.fn.menu.methods[a](this,b):(a=a||{},this.each(function(){var b=$.data(this,"menu");b?$.extend(b.options,a):(b=$.data(this,"menu",{options:$.extend({},$.fn.menu.defaults,$.fn.menu.parseOptions(this),a)}),init(this)),$(this).css({left:b.options.left,top:b.options.top})}))},$.fn.menu.methods={options:function(a){return $.data(a[0],"menu").options},show:function(a,b){return a.each(function(){showMenu(this,b)})},hide:function(a){return a.each(function(){hideAll(this)})},destroy:function(a){return a.each(function(){destroyMenu(this)})},setText:function(a,b){return a.each(function(){$(b.target).children("div.menu-text").html(b.text)})},setIcon:function(a,b){return a.each(function(){var a=$(this).menu("getItem",b.target);a.iconCls?$(a.target).children("div.menu-icon").removeClass(a.iconCls).addClass(b.iconCls):$('<div class="menu-icon"></div>').addClass(b.iconCls).appendTo(b.target)})},getItem:function(a,b){var f,g,h,c=$(b),d={target:b,id:c.attr("id"),text:$.trim(c.children("div.menu-text").html()),disabled:c.hasClass("menu-item-disabled"),href:c.attr("href"),name:c.attr("name"),onclick:b.onclick},e=c.children("div.menu-icon");if(e.length){for(f=[],g=e.attr("class").split(" "),h=0;h<g.length;h++)"menu-icon"!=g[h]&&f.push(g[h]);d.iconCls=f.join(" ")}return d},findItem:function(a,b){return findItem(a[0],b)},appendItem:function(a,b){return a.each(function(){appendItem(this,b)})},removeItem:function(a,b){return a.each(function(){removeItem(this,b)})},enableItem:function(a,b){return a.each(function(){setDisabled(this,b,!1)})},disableItem:function(a,b){return a.each(function(){setDisabled(this,b,!0)})}},$.fn.menu.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a,["left","top",{minWidth:"number"}]))},$.fn.menu.defaults={zIndex:11e4,left:0,top:0,minWidth:120,onShow:function(){},onHide:function(){},onClick:function(){}},buildMenu=function(a){var f,b=$.util.guid("N",12),c="easyui_menu_id_"+b,d="easyui_menu_name_"+b,e=$.extend({},$.fn.menu.defaults,{id:c,name:d,left:window.event?window.event.clientX:0,top:window.event?window.event.clientY:0,items:null,hideDisabledMenu:!1},a||{});return e.items=$.array.isArray(e.items)?e.items:[],f=$("<div></div>").attr({id:c,name:d}).appendTo("body"),e.items.length||e.items.push({text:"当前无菜单项",disabled:!0}),$.each(e.items,function(){e.hideDisabledMenu&&this.disabled||appendItemToMenu(f,this,c,f)}),{menu:f,options:e}},appendItemToMenu=function(a,b,c,d){var e,f,g,h,i,j,k,l;return $.util.isString(b)&&"-"==$.trim(b)?($("<div></div>").addClass("menu-sep").appendTo(a),void 0):(e=$.util.guid("N",12),f=c+"_"+e,b=b||{},b=$.extend({id:f,text:"",iconCls:null,href:null,disabled:!1,onclick:null,handler:null,bold:!1,style:null,children:null,hideDisabledMenu:!1,hideOnClick:!0},b),g=b.onclick,h=b.handler,b.onclick=undefined,b.handler=undefined,b=$.util.parseMapFunction(b),b.onclick=g,b.handler=h,b.hideDisabledMenu&&b.disabled||(i=$("<div></div>").attr({id:b.id,iconCls:b.iconCls,href:b.href,disabled:b.disabled,hideOnClick:b.hideOnClick}).appendTo(a),b.style&&i.css(b.style),$.isFunction(b.handler)&&(h=b.handler,b.onclick=function(a,b,c){h.call(this,a,b,c)}),$.isFunction(b.onclick)&&i.click(function(a){b.onclick.call(this,a,b,d)}),j=b.children&&b.children.length?!0:!1,k=$("<span></span>").text(b.text).appendTo(i),b.bold&&k.css("font-weight","bold"),j&&(l=$("<div></div>").appendTo(i),$.each(b.children,function(){var a=$.util.isString(this)&&"-"==$.trim(this)?this:$.extend({hideDisabledMenu:b.hideDisabledMenu},this);appendItemToMenu(l,a,f,d)}))),void 0)},$.extend($.easyui,{createMenu:buildMenu,showMenu:function(a){var e,b=a||{},c=$.fn.menu.defaults.onHide,d=b.onHide;return b.onHide=function(){var a=$.util.parseJquery(this);$.isFunction(c)&&c.apply(this,arguments),$.isFunction(d)&&d.apply(this,arguments),$.util.call(function(){a.menu("destroy")})},e=buildMenu(b),e.menu.menu(e.options).menu("show",{left:e.options.left,top:e.options.top}),e.menu}})}(jQuery);